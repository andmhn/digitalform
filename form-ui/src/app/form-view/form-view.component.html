@if(error){
    <p-message severity="error" variant="outlined" closable>
        <p>{{error.error}}</p>
        <p>{{error.message}}</p>
    </p-message>
}

@if(isSubmitted){
    <p-message severity="success" variant="outlined">
        <p>You have Successfully Submitted the Form</p>
    </p-message>
    <h3 style="cursor: pointer; color: skyblue;"><u><a (click)="showAgain()" >Submit Again</a></u></h3>
}

@if(formData && isSubmitted === false) {
    <p-card>
        <ng-template pTemplate="title">
            <h1>{{formData.header}}</h1>
        </ng-template>
        <h2>{{formData.description}}</h2>
    </p-card>
    <br>
    <div style="
        display: flex;
        justify-content: center;
        align-items: center;
    ">
        <div [formGroup]="formInput"  style="width: 100%; max-width: 900px;">
            @for (question of formData.questions; track $index) {
                @let question_id = question.question_id.toString();
                <p-card>
                    @if(question.required && !formInput.get(question_id)?.valid){
                        <div style="color: red; float: right;">*</div>
                    }
                    <h2>{{$index + 1}}. {{question.query}} </h2>
                    
                    @switch (question.type) {
                        @case ('email') {
                            <p-floatlabel variant="on">
                                <input pInputText [fluid]="true" type="email" id="{{question_id}}" formControlName="{{question_id}}" autocomplete="email"/>
                                <label for="{{question_id}}">Email</label>
                            </p-floatlabel>
                        }
                        @case ('short_answer') {
                            <p-floatlabel variant="on">
                                <textarea [fluid]="true" pTextarea id="{{question_id}}" formControlName="{{question_id}}" rows="2" style="resize: none;" class="h-full"></textarea>
                                <label for="{{question_id}}">short answer</label>
                            </p-floatlabel>
                        }
                        @case ('long_answer') {
                            <p-floatlabel variant="on">
                                <textarea [fluid]="true" pTextarea id="{{question_id}}" formControlName="{{question_id}}" rows="4" class="h-full" [autoResize]="true"></textarea>
                                <label for="{{question_id}}">long answer</label>
                            </p-floatlabel>
                        }
                        @case ('number') {
                            <p-floatlabel variant="on">
                                <p-inputnumber inputId="{{question_id}}" [fluid]="true" formControlName="{{question_id}}" mode="decimal" [useGrouping]="false" />
                                <label for="{{question_id}}">number</label>
                            </p-floatlabel>
                        }
                        @case ('rupees') {
                            <p-floatlabel variant="on">
                                <p-inputnumber inputId="{{question_id}}" [fluid]="true" formControlName="{{question_id}}"  mode="currency" currency="INR" locale="en-IN"/>
                                <label for="{{question_id}}">rupees</label>
                            </p-floatlabel>
                        }
                        @case ('date') {
                            <p-floatlabel variant="on">
                                <p-datepicker inputId="{{question_id}}" formControlName="{{question_id}}" dateFormat="dd/mm/yy" />
                                <label for="{{question_id}}">date</label>
                            </p-floatlabel>
                        }
                        @case ('multiple_dropdown') {
                            <p-floatlabel class="w-full md:w-80" variant="on">
                                <p-multiselect inputId="{{question_id}}" [fluid]="true"  formControlName="{{question_id}}" [options]="question.choices" filter [maxSelectedLabels]="5" styleClass="w-full" />
                                <label for="{{question_id}}">Multiple Dropdown</label>
                            </p-floatlabel>
                        }
                        @case ('radiobox') {
                            <div class="flex flex-col gap-4">
                                @for (choice of question.choices; track $index) {
                                    <div class="field-checkbox" style="margin: 10px;">
                                        <p-radiobutton inputId="{{question_id + $index}}" [value]="choice" formControlName="{{question_id}}"/>
                                        <label for="{{question_id + $index}}" class="ml-2"> {{ choice }}</label>
                                    </div>
                                }
                            </div>
                        }
                        @case ('checkbox') {
                            @for (choice of question.choices; track $index) {
                                <div class="flex items-center" style="margin: 10px;">
                                    <p-checkbox inputId="{{question_id + $index}}" value="{{choice}}" formControlName="{{question_id}}" />
                                    <label for="{{question_id + $index}}" class="ml-2"> {{choice}} </label>
                                </div>
                            }
                        }
                        @default {
                            <input type="text" id="{{question_id}}"  [fluid]="true" pInputText formControlName="{{question_id}}" placeholder="{{question.type}}"/>            
                        }
                    }
                </p-card>
                <br>
            }
            <p-button type="submit" [disabled]="!formInput.valid" (click)="submit()">submit</p-button>
        </div>
    </div>
}